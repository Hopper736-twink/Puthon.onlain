<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Python Live Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
:root {
  --bg:#0d1117; --panel:#161b22; --border:#30363d;
  --text:#c9d1d9; --accent:#58a6ff; --green:#2ea043;
}
* { box-sizing:border-box }
body {
  margin:0; background:var(--bg); color:var(--text);
  font-family:monospace; height:100vh; display:flex; flex-direction:column;
}
header {
  background:var(--panel); padding:8px; display:flex; gap:6px;
  border-bottom:1px solid var(--border);
}
button {
  flex:1; padding:10px; border:none; border-radius:6px;
  font-weight:bold; color:white; cursor:pointer;
}
.run{background:var(--green)}
.ai{background:var(--accent)}
.net{background:#f39c12}

#status {
  font-size:12px; padding:6px 10px; border-bottom:1px solid var(--border);
  display:flex; justify-content:space-between;
}
#editor {
  flex:1; width:100%; resize:none; border:none; outline:none;
  padding:14px; background:var(--bg); color:var(--text);
  font-size:15px; line-height:1.5;
}
#log {
  height:22%; background:#000; color:#3aff3a;
  padding:10px; font-size:13px; overflow:auto;
}
</style>
</head>

<body>

<header>
  <button class="run" onclick="run()">‚ñ∂ RUN</button>
  <button class="ai" onclick="localAI()">ü§ñ –ü–û–ú–û–©–¨</button>
  <button class="net" onclick="connect()">üåê –°–ï–¢–¨</button>
</header>

<div id="status">
  <span id="sid">ID: ‚Äî</span>
  <span id="role">–†–æ–ª—å: SOLO</span>
</div>

<textarea id="editor">print("Hello Python Live")</textarea>
<div id="log">–ì–æ—Ç–æ–≤–æ.</div>

<script>
let peer, conn;
let isHost = false;
const ed = document.getElementById("editor");
const log = document.getElementById("log");

function println(t){ log.textContent += "\n" + t; log.scrollTop=9999 }

peer = new Peer();

peer.on("open", id=>{
  document.getElementById("sid").textContent = "ID: " + id;
});

peer.on("connection", c=>{
  if(conn) return;
  conn = c;
  isHost = true;
  document.getElementById("role").textContent = "–†–æ–ª—å: HOST";
  conn.on("data", d=> ed.value = d);
});

ed.addEventListener("input", ()=>{
  if(isHost && conn) conn.send(ed.value);
});

function connect(){
  if(isHost) return;
  const id = prompt("ID —Ö–æ—Å—Ç–∞:");
  if(!id) return;
  conn = peer.connect(id);
  conn.on("open", ()=>{
    document.getElementById("role").textContent = "–†–æ–ª—å: CLIENT";
    conn.on("data", d=> ed.value = d);
  });
}

function run(){
  log.textContent = "‚ñ∂ –ó–∞–ø—É—Å–∫ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞\n(–≠—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä, –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä)";
}

function localAI(){
  let code = ed.value;

  // –∞–≤—Ç–æ-–æ—Ç—Å—Ç—É–ø—ã
  code = code.replace(/:\n(\S)/g, ":\n    $1");

  // if –±–µ–∑ –¥–≤–æ–µ—Ç–æ—á–∏—è
  code = code.replace(/^(\s*)(if|for|while|def)\s+(.+)$/gm,
    "$1$2 $3:");

  // –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π ‚Üí pass
  code = code.replace(/#\s*todo/gi, "pass");

  // –ø—É—Å—Ç—ã–µ def
  code = code.replace(/def\s+(\w+)\(.*?\):\n(\s*)$/gm,
    "def $1():\n$2    pass\n");

  ed.value = code;
  if(isHost && conn) conn.send(code);
  println("ü§ñ –ò–ò: –∫–æ–¥ —É–ª—É—á—à–µ–Ω");
}
</script>

</body>
</html>
